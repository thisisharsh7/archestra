archestra:
  replicaCount: 4

  # Faster rolling updates: allow 2 pods to be created at once
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: "50%"

  # Vertex AI Gemini configuration
  # Uses Application Default Credentials (ADC) via GKE Workload Identity
  # instead of API keys for authentication
  env:
    ARCHESTRA_GEMINI_VERTEX_AI_ENABLED: "true"
    ARCHESTRA_GEMINI_VERTEX_AI_PROJECT: "friendly-path-465518-r6"
    ARCHESTRA_GEMINI_VERTEX_AI_LOCATION: "us-central1"

  # Orchestrator configuration with Workload Identity for Vertex AI
  orchestrator:
    kubernetes:
      serviceAccount:
        # GKE Workload Identity binding to allow Vertex AI access via ADC
        # The GCP service account (archestra-vertex-ai@friendly-path-465518-r6.iam.gserviceaccount.com)
        # is created and bound in the archestra-ai/infra repo (gke/main.tf)
        annotations:
          iam.gke.io/gcp-service-account: archestra-vertex-ai@friendly-path-465518-r6.iam.gserviceaccount.com

  service:
    annotations:
      # GKE BackendConfig for custom health checks
      # Maps backend port (9000) and frontend port (3000) to their respective BackendConfigs
      # These BackendConfigs are defined in archestra-ai/infra repo (gke/ingress.tf)
      cloud.google.com/backend-config: '{"ports": {"9000":"archestra-platform-backend-config", "3000":"archestra-platform-frontend-config"}}'

  ingress:
    enabled: true
    annotations:
      # GKE Ingress Controller configuration
      kubernetes.io/ingress.class: "gce"
      kubernetes.io/ingress.global-static-ip-name: "archestra-staging-ip"
      ingress.gcp.cloud.google.com/load-balancer-type: "External"
      networking.gke.io/managed-certificates: "archestra-platform-staging-ssl"
      ingress.gcp.cloud.google.com/ssl-redirect: "true"

    hosts:
      - host: frontend.archestra.dev
        paths:
          - path: /
            port: 3000
            pathType: Prefix
      - host: backend.archestra.dev
        paths:
          # Block public access to metrics endpoint
          - path: /metrics
            port: 1
            pathType: Exact
          - path: /
            port: 9000
            pathType: Prefix
